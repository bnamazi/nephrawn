# Nephrawn Frontend Plan — Hardened Against Backend Reality

Generated by reconciling `FRONTEND_PLAN.md` with actual backend implementation.

---

## A) API Contract Snapshot (Authoritative)

This is the definitive list of implemented API routes extracted from backend source code.

### Authentication (`/auth`) — Public

| Method | Path | Request Body | Response Shape |
|--------|------|--------------|----------------|
| POST | `/auth/patient/register` | `{email, password, name, dateOfBirth}` | `{token, user: {id, email, name, role}}` |
| POST | `/auth/patient/login` | `{email, password}` | `{token, user: {id, email, name, role}}` |
| POST | `/auth/clinician/login` | `{email, password}` | `{token, user: {id, email, name, role}}` |

**Validation:**
- `email`: valid email format
- `password`: min 8 chars (register), min 1 char (login)
- `name`: min 1 char
- `dateOfBirth`: ISO date string, converted to Date

**Errors:**
- 400: Validation failed (with `details` array)
- 401: Invalid credentials (login)
- 400: "Email already registered" (register)

---

### Patient Routes (`/patient`) — Requires `patient` role

#### Profile

| Method | Path | Query Params | Response Shape |
|--------|------|--------------|----------------|
| GET | `/patient/me` | — | `{patient: {id, email, name, dateOfBirth, preferences, createdAt}}` |

#### Symptom Check-ins

| Method | Path | Request | Response Shape |
|--------|------|---------|----------------|
| POST | `/patient/checkins` | Body: `{symptoms, notes?, timestamp?}` | `{checkin: {id, patientId, timestamp, symptoms, notes, createdAt}}` |
| GET | `/patient/checkins` | Query: `limit?, offset?` | `{checkins: [{id, patientId, timestamp, symptoms, notes, createdAt}]}` |

**Symptoms Schema (severity: 0-3, NOT 1-10):**
```json
{
  "symptoms": {
    "edema": { "severity": 0-3, "location?": string },
    "fatigue": { "severity": 0-3 },
    "shortnessOfBreath": { "severity": 0-3, "atRest?": boolean },
    "nausea": { "severity": 0-3 },
    "appetite": { "level": 0-3 },
    "pain": { "severity": 0-3, "location?": string }
  },
  "notes?": string,
  "timestamp?": ISO8601
}
```

#### Measurements

| Method | Path | Request | Response Shape |
|--------|------|---------|----------------|
| POST | `/patient/measurements` | Body: `{type, value, unit, timestamp?}` | See below |
| POST | `/patient/measurements/blood-pressure` | Body: `{systolic, diastolic, unit?, timestamp?}` | See below |
| GET | `/patient/measurements` | Query: `limit?, offset?, type?` | `{measurements: [...]}` |

**Single Measurement Response (normal):**
```json
{
  "measurement": {id, patientId, timestamp, type, value, unit, inputUnit, source, externalId, createdAt},
  "convertedFrom": "lbs" | undefined
}
```

**Single Measurement Response (duplicate):**
```json
{
  "measurement": {...},
  "isDuplicate": true,
  "message": "Duplicate measurement detected, returning existing record"
}
```

**Blood Pressure Response:**
```json
{
  "measurements": {
    "systolic": {id, patientId, timestamp, type, value, unit, ...},
    "diastolic": {id, patientId, timestamp, type, value, unit, ...}
  },
  "isDuplicate": boolean
}
```

**Valid Measurement Types:** `WEIGHT`, `BP_SYSTOLIC`, `BP_DIASTOLIC`, `SPO2`, `HEART_RATE`

**Valid Units:**
- WEIGHT: `kg`, `lbs`
- BP: `mmHg`
- SPO2: `%`
- HEART_RATE: `bpm`

#### Alerts

| Method | Path | Query Params | Response Shape |
|--------|------|--------------|----------------|
| GET | `/patient/alerts` | `limit?, offset?` | `{alerts: [{id, patientId, triggeredAt, ruleId, ruleName, severity, status, inputs, summaryText, acknowledgedBy, acknowledgedAt, createdAt, updatedAt, patient: {id, name}}]}` |

**Note:** Patient alerts do NOT support status filtering (unlike clinician alerts).

#### Dashboard & Charts

| Method | Path | Query Params | Response Shape |
|--------|------|--------------|----------------|
| GET | `/patient/dashboard` | `from?, to?` | See DashboardResponse below |
| GET | `/patient/charts/:type` | `from?, to?, limit?, aggregate?` | See ChartResponse below |
| GET | `/patient/summary/:type` | `from?, to?` | `{summary: MeasurementSummary}` |

**DashboardResponse:**
```json
{
  "dashboard": {
    "weight": MeasurementSummary,
    "bloodPressure": {
      "systolic": MeasurementSummary,
      "diastolic": MeasurementSummary
    },
    "spo2": MeasurementSummary,
    "heartRate": MeasurementSummary,
    "meta": {
      "timezone": "UTC",
      "generatedAt": ISO8601
    }
  }
}
```

**IMPORTANT:** Dashboard does NOT include `recentAlerts` or `recentCheckins`. These must be fetched separately.

**MeasurementSummary:**
```json
{
  "type": "WEIGHT",
  "unit": "kg",
  "displayUnit": "kg",
  "latest": { "value": number, "timestamp": ISO8601 } | null,
  "stats": { "min", "max", "avg", "count" } | null,
  "trend": "increasing" | "decreasing" | "stable" | "insufficient_data",
  "trendMeta?": {
    "method": "two_window_comparison",
    "recentWindowSize", "olderWindowSize",
    "recentAvg", "olderAvg", "absoluteChange",
    "thresholdUsed", "timeSpanMs", "minTimeSpanMs"
  },
  "range": { "from", "to" },
  "meta": { "timezone" }
}
```

**Chart Types:** `WEIGHT`, `BP_SYSTOLIC`, `BP_DIASTOLIC`, `SPO2`, `HEART_RATE`, `blood-pressure`, `BP`

**TimeSeriesResponse (single type):**
```json
{
  "data": {
    "type": "WEIGHT",
    "unit": "kg",
    "displayUnit": "kg",
    "points": [{ "timestamp", "value" }],
    "range": { "from", "to" },
    "meta": { "timezone", "totalCount", "returnedCount", "hasMore" }
  }
}
```

**BloodPressureResponse:**
```json
{
  "data": {
    "unit": "mmHg",
    "points": [{ "timestamp", "systolic", "diastolic" }],
    "range": { "from", "to" },
    "meta": {
      "timezone", "pairingWindowMs", "pairedCount",
      "unpairedSystolicCount", "unpairedDiastolicCount"
    }
  }
}
```

**DailyAggregateResponse (when `aggregate=daily`):**
```json
{
  "data": {
    "type": "WEIGHT",
    "unit": "kg",
    "displayUnit": "kg",
    "aggregates": [{ "date", "min", "max", "avg", "count" }],
    "range": { "from", "to" },
    "meta": { "timezone", "bucketDefinition", "totalDays" }
  }
}
```

---

### Clinician Routes (`/clinician`) — Requires `clinician` or `admin` role

#### Profile & Patients

| Method | Path | Query/Path | Response Shape |
|--------|------|------------|----------------|
| GET | `/clinician/me` | — | `{clinician: {id, email, name, role, createdAt}}` |
| GET | `/clinician/patients` | — | `{patients: [{id, name, email, dateOfBirth, enrolledAt, isPrimary}]}` |
| GET | `/clinician/patients/:patientId` | path: patientId | `{patient: {id, name, email, dateOfBirth, preferences}, enrollment: {id, status, isPrimary, enrolledAt}}` |

**IMPORTANT:** Patient list does NOT include `alertCount` or `lastCheckinAt`. Frontend must compute these via separate calls if needed.

#### Patient Data Access

| Method | Path | Query Params | Response Shape |
|--------|------|--------------|----------------|
| GET | `/clinician/patients/:patientId/checkins` | `limit?, offset?` | `{checkins: [...]}` |
| GET | `/clinician/patients/:patientId/measurements` | `limit?, offset?, type?` | `{measurements: [...]}` |
| GET | `/clinician/patients/:patientId/dashboard` | `from?, to?` | `{dashboard: {...}}` (same as patient) |
| GET | `/clinician/patients/:patientId/charts/:type` | `from?, to?, limit?, aggregate?` | Same as patient charts |
| GET | `/clinician/patients/:patientId/summary/:type` | `from?, to?` | Same as patient summary |

#### Alerts

| Method | Path | Query/Path | Response Shape |
|--------|------|------------|----------------|
| GET | `/clinician/alerts` | `limit?, offset?, status?` | `{alerts: [{...alert, patient: {id, name, email}}]}` |
| GET | `/clinician/alerts/:alertId` | path: alertId | `{alert: {..., patient, clinician}}` |
| POST | `/clinician/alerts/:alertId/acknowledge` | path: alertId | `{success: true, message: "Alert acknowledged"}` |
| POST | `/clinician/alerts/:alertId/dismiss` | path: alertId | `{success: true, message: "Alert dismissed"}` |
| GET | `/clinician/alerts/:alertId/notes` | path: alertId | `{notes: [...]}` |

**Status values for filter:** `OPEN`, `ACKNOWLEDGED`, `DISMISSED`

**IMPORTANT:** There is NO `/clinician/patients/:patientId/alerts` endpoint. To get alerts for a specific patient, fetch all via `/clinician/alerts` and filter client-side.

#### Clinical Notes

| Method | Path | Request | Response Shape |
|--------|------|---------|----------------|
| POST | `/clinician/patients/:patientId/notes` | Body: `{content, alertId?}` | `{note: {id, patientId, clinicianId, alertId, content, createdAt, updatedAt, clinician: {id, name}, alert?: {id, ruleId, ruleName}}}` |
| GET | `/clinician/patients/:patientId/notes` | Query: `limit?, offset?` | `{notes: [...]}` |
| GET | `/clinician/notes/:noteId` | — | `{note: {...}}` |
| PUT | `/clinician/notes/:noteId` | Body: `{content}` | `{note: {...}}` |
| DELETE | `/clinician/notes/:noteId` | — | `{success: true, message: "Note deleted"}` |

---

## B) Screen-to-Endpoint Mapping (Validated)

### Patient App (Flutter)

#### P1. Login Screen
**Endpoints:**
- `POST /auth/patient/login`

**Corrections from original plan:**
- Response is `{token, user}` not `{token, patient}`
- Store token in Flutter secure storage (confirmed correct)

#### P2. Registration Screen
**Endpoints:**
- `POST /auth/patient/register`

**Corrections:**
- Response shape matches login: `{token, user}`

#### P3. Dashboard Screen
**Endpoints required:**
- `GET /patient/dashboard` — measurement summaries
- `GET /patient/alerts?limit=5` — recent alerts (SEPARATE CALL)
- `GET /patient/checkins?limit=3` — recent checkins (SEPARATE CALL)

**CRITICAL CORRECTION:**
Dashboard endpoint does NOT return `recentAlerts` or `recentCheckins`. Frontend must make 3 separate API calls and compose the view.

**Actual dashboard response structure:**
```json
{
  "dashboard": {
    "weight": { "latest", "trend", "stats", ... },
    "bloodPressure": { "systolic": {...}, "diastolic": {...} },
    "spo2": {...},
    "heartRate": {...},
    "meta": { "timezone", "generatedAt" }
  }
}
```

#### P4. Symptom Check-in Screen
**Endpoints:**
- `POST /patient/checkins`

**CRITICAL CORRECTION:**
Severity scale is **0-3**, NOT 1-10:
- 0 = none
- 1 = mild
- 2 = moderate
- 3 = severe

Symptom keys are specific: `edema`, `fatigue`, `shortnessOfBreath`, `nausea`, `appetite`, `pain`

#### P5. Symptom History Screen
**Endpoints:**
- `GET /patient/checkins?limit=50&offset=0`

**Corrections:** None significant.

#### P6. Measurement Entry Screen (Weight)
**Endpoints:**
- `POST /patient/measurements`

**Request body:**
```json
{
  "type": "WEIGHT",
  "value": 185,
  "unit": "lbs",
  "timestamp": "2025-01-02T10:00:00Z"
}
```

**CORRECTION:** `convertedFrom` is a string (the original unit), not an object.

#### P7. Measurement Entry Screen (Blood Pressure)
**Endpoints:**
- `POST /patient/measurements/blood-pressure`

**Request body:**
```json
{
  "systolic": 135,
  "diastolic": 85,
  "unit": "mmHg",
  "timestamp": "2025-01-02T10:00:00Z"
}
```

**CORRECTION:** Response structure is `{measurements: {systolic, diastolic}, isDuplicate}`, not `{systolic, diastolic}` at root.

#### P8. Measurement History / Charts Screen
**Endpoints:**
- `GET /patient/charts/:type?from=&to=&limit=&aggregate=`
- `GET /patient/summary/:type?from=&to=`

**Valid types:** `WEIGHT`, `blood-pressure`, `BP_SYSTOLIC`, `BP_DIASTOLIC`, `SPO2`, `HEART_RATE`

**Corrections:** None significant.

#### P9. Alerts Screen (Patient View)
**Endpoints:**
- `GET /patient/alerts?limit=50&offset=0`

**CORRECTION:** No `status` filter available for patient alerts. All alerts are returned.

#### P10. Settings / More Screen
**Endpoints:**
- `GET /patient/me`

**Corrections:** None significant.

---

### Clinician App (React/Next.js)

#### C1. Login Screen
**Endpoints:**
- `POST /auth/clinician/login`

**Corrections:**
- Response is `{token, user}`. Web app should use httpOnly cookies.
- ARCH.md specifies no localStorage for tokens on web.

**NOTE:** No explicit logout endpoint exists. Options:
1. Clear httpOnly cookie client-side
2. Let token expire naturally
3. (If needed) Add `/auth/logout` endpoint

#### C2. Patient List Screen
**Endpoints:**
- `GET /clinician/patients`

**CRITICAL CORRECTION:**
Response does NOT include `alertCount` or `lastCheckinAt`.

Actual response:
```json
{
  "patients": [
    { "id", "name", "email", "dateOfBirth", "enrolledAt", "isPrimary" }
  ]
}
```

**Options for enriched patient list:**
1. Accept simpler list (no alert badges) for MVP
2. Make N+1 calls per patient (not recommended)
3. Accept this as a gap requiring backend enhancement

#### C3. Patient Detail Screen (Overview Tab)
**Endpoints:**
- `GET /clinician/patients/:patientId` — patient info + enrollment
- `GET /clinician/patients/:patientId/dashboard` — measurement summaries
- `GET /clinician/alerts?status=OPEN` + client-side filter by patientId — alerts
- `GET /clinician/patients/:patientId/checkins?limit=3` — recent checkins

**CRITICAL:** No dedicated patient-specific alerts endpoint. Must filter from global alerts.

#### C4. Patient Measurements Tab
**Endpoints:**
- `GET /clinician/patients/:patientId/charts/:type`
- `GET /clinician/patients/:patientId/summary/:type`

**Corrections:** None.

#### C5. Patient Symptoms Tab
**Endpoints:**
- `GET /clinician/patients/:patientId/checkins`

**Corrections:** None.

#### C6. Patient Alerts Tab
**Endpoints:**
- `GET /clinician/alerts` (filter client-side by patientId)
- `POST /clinician/alerts/:alertId/acknowledge`
- `POST /clinician/alerts/:alertId/dismiss`

**GAP:** No `/clinician/patients/:patientId/alerts` endpoint. Must use global alerts and filter.

#### C7. Patient Notes Tab
**Endpoints:**
- `GET /clinician/patients/:patientId/notes`
- `POST /clinician/patients/:patientId/notes`
- `PUT /clinician/notes/:noteId`
- `DELETE /clinician/notes/:noteId`

**Corrections:** None.

#### C8. Alert Inbox Screen (Global)
**Endpoints:**
- `GET /clinician/alerts?status=OPEN&limit=50`

**Corrections:** None.

#### C9. Alert Detail Modal/Page
**Endpoints:**
- `GET /clinician/alerts/:alertId`
- `GET /clinician/alerts/:alertId/notes`
- `POST /clinician/alerts/:alertId/acknowledge`
- `POST /clinician/alerts/:alertId/dismiss`

**Corrections:** None.

#### C10. Settings / Profile Screen
**Endpoints:**
- `GET /clinician/me`

**Corrections:** None.

---

## C) Confirmed Missing Endpoints

### C.1 Patient-scoped alerts for clinician — **BLOCKING GAP**

**Current state:** `GET /clinician/alerts` returns all alerts for all enrolled patients. No `patientId` query parameter.

**Impact:** Clinician Patient Alerts Tab must fetch ALL alerts and filter client-side. Inefficient but workable.

**Workaround:** Filter `alerts.filter(a => a.patientId === targetPatientId)` on frontend.

**Recommendation:** Accept workaround for MVP. If performance becomes an issue with many patients/alerts, add `?patientId=` filter to backend.

### C.2 Logout endpoint — **NON-BLOCKING**

**Current state:** No `/auth/logout` endpoint.

**Impact:** Web app cannot server-side invalidate sessions.

**Workaround:**
- For web: Clear httpOnly cookie via `Set-Cookie` with expired date (requires same-origin API)
- For mobile: Simply delete token from secure storage

**Recommendation:** Accept for MVP. Token expiration handles this naturally.

### C.3 Patient list enrichment (alertCount, lastCheckinAt) — **NON-BLOCKING**

**Current state:** `GET /clinician/patients` returns basic patient info only.

**Impact:** Cannot show alert badges or "last activity" on patient list without additional calls.

**Workaround options:**
1. MVP: Show simple patient list without alert counts
2. Future: Add aggregated endpoint or batch query

**Recommendation:** Accept simpler list for MVP. This is a "nice to have" not a blocker.

---

## D) Revised MVP Slice Order

Reordered for vertical slice development with validated endpoints.

### Slice 1: Patient Auth + First Measurement

**Goal:** Patient can log in, add weight, see it in history.

**Screens:**
1. P1. Login Screen
2. P6. Measurement Entry (Weight)
3. P8. Measurement History (Weight only)

**Endpoints required:**
- `POST /auth/patient/login`
- `POST /patient/measurements`
- `GET /patient/measurements?type=WEIGHT`
- `GET /patient/charts/WEIGHT`

**Data flow:**
```
Login → JWT stored → Add Weight → POST succeeds →
Fetch measurements → See weight in list/chart
```

**Stubbing:** None needed. All endpoints exist and are verified.

---

### Slice 2: Patient Registration + Profile

**Goal:** New patient can register and view profile.

**Screens:**
1. P2. Registration Screen
2. P10. Settings Screen

**Endpoints required:**
- `POST /auth/patient/register`
- `GET /patient/me`

**Data flow:**
```
Register → JWT stored → View profile
```

**Note:** Registration creates patient but they won't have enrollment. This is expected.

---

### Slice 3: Patient Dashboard (Composed)

**Goal:** Patient sees unified dashboard with summaries.

**Screens:**
1. P3. Dashboard Screen (partial — summaries only first)

**Endpoints required:**
- `GET /patient/dashboard`

**Data flow:**
```
Dashboard → Show weight/BP/SpO2/HR summaries with trends
```

**Note:** Alerts and checkins added in later slices.

---

### Slice 4: Patient Blood Pressure

**Goal:** Patient can add and view BP readings.

**Screens:**
1. P7. Measurement Entry (BP)
2. P8. Measurement History (BP tab)

**Endpoints required:**
- `POST /patient/measurements/blood-pressure`
- `GET /patient/charts/blood-pressure`

**Data flow:**
```
Enter systolic/diastolic → POST → See paired BP chart
```

---

### Slice 5: Patient Symptom Check-ins

**Goal:** Patient can report symptoms and view history.

**Screens:**
1. P4. Symptom Check-in Screen
2. P5. Symptom History Screen

**Endpoints required:**
- `POST /patient/checkins`
- `GET /patient/checkins`

**IMPORTANT:** Remember severity is 0-3, not 1-10!

---

### Slice 6: Patient Alerts + Full Dashboard

**Goal:** Patient can view alerts; dashboard shows recent alerts + checkins.

**Screens:**
1. P9. Alerts Screen
2. P3. Dashboard (enhanced with alerts + checkins)

**Endpoints required:**
- `GET /patient/alerts`
- `GET /patient/checkins?limit=3`

**Composition logic:**
```javascript
// Dashboard composition
const [dashboard, alerts, checkins] = await Promise.all([
  fetchDashboard(),
  fetchAlerts({ limit: 5 }),
  fetchCheckins({ limit: 3 })
]);
```

---

### Slice 7: Clinician Auth + Patient List

**Goal:** Clinician can log in and see enrolled patients.

**Screens:**
1. C1. Login Screen
2. C2. Patient List Screen

**Endpoints required:**
- `POST /auth/clinician/login`
- `GET /clinician/patients`

**Note:** Patient list will be simple (no alert badges) per backend reality.

---

### Slice 8: Clinician Patient Detail

**Goal:** Clinician can view patient overview with measurements.

**Screens:**
1. C3. Patient Detail (Overview tab)
2. C4. Patient Measurements Tab

**Endpoints required:**
- `GET /clinician/patients/:patientId`
- `GET /clinician/patients/:patientId/dashboard`
- `GET /clinician/patients/:patientId/charts/:type`

---

### Slice 9: Clinician Symptoms + Alerts

**Goal:** Clinician can view patient symptoms and manage alerts.

**Screens:**
1. C5. Patient Symptoms Tab
2. C6. Patient Alerts Tab
3. C8. Alert Inbox (Global)

**Endpoints required:**
- `GET /clinician/patients/:patientId/checkins`
- `GET /clinician/alerts` (filter client-side for patient tab)
- `POST /clinician/alerts/:alertId/acknowledge`
- `POST /clinician/alerts/:alertId/dismiss`

---

### Slice 10: Clinician Notes + Polish

**Goal:** Clinician can add/edit notes; all screens polished.

**Screens:**
1. C7. Patient Notes Tab
2. C9. Alert Detail Modal
3. C10. Settings Screen
4. All screens: loading/error/empty states

**Endpoints required:**
- `GET /clinician/patients/:patientId/notes`
- `POST /clinician/patients/:patientId/notes`
- `PUT /clinician/notes/:noteId`
- `DELETE /clinician/notes/:noteId`
- `GET /clinician/alerts/:alertId`
- `GET /clinician/alerts/:alertId/notes`
- `GET /clinician/me`

---

## E) Risks / Ambiguities That Must Be Resolved Before UI Work

### RESOLVED

1. **Session handling for web app** — RESOLVED
   - ARCH.md says "httpOnly cookies for web"
   - Backend currently returns JWT in response body only (no cookies set)
   - No cookie-parser middleware, no CORS configuration

   **Decision:** Accept JWT-in-body for MVP with secure storage strategy:

   | Platform | Storage | Behavior |
   |----------|---------|----------|
   | Flutter (mobile) | `flutter_secure_storage` | OS-encrypted, persists across app restarts |
   | React (web) | In-memory state only | Lost on page refresh (re-login required) |

   **Security rationale:**
   - Mobile: Secure storage is encrypted at OS level — equivalent security to httpOnly cookies
   - Web: In-memory storage cannot be stolen via XSS (unlike localStorage)
   - Trade-off: Web users re-login on refresh, acceptable for MVP demo

   **Future enhancement (post-MVP):**
   - Add `cookie-parser` middleware
   - Configure CORS for credentials
   - Set `Set-Cookie: token=...; HttpOnly; Secure; SameSite=Strict` on login
   - Add `/auth/logout` to clear cookie

2. **Enrollment prerequisite** — RESOLVED
   - Newly registered patients have no enrollment
   - **Finding:** Patient routes do NOT check enrollment. Patients can use app fully without a clinician.
   - Enrollment is only required for clinicians to view patient data (not for patient self-service).

   **Backend behavior for patients with no data:**

   | Endpoint | Response |
   |----------|----------|
   | Dashboard | All summaries: `latest: null`, `stats: null`, `trend: "insufficient_data"` |
   | Charts | `{data: null, message: "No {type} data found"}` |
   | Measurements | `{measurements: []}` |
   | Checkins | `{checkins: []}` |
   | Alerts | `{alerts: []}` |

   **Decision:** Use standard empty states, no special "waiting for clinician" UI needed.

   | Screen | Empty State Message |
   |--------|---------------------|
   | Dashboard | "Add your first measurement to start tracking your health" |
   | Measurements | "No measurements recorded yet" + Add button |
   | Checkins | "No symptom check-ins yet" + Add button |
   | Alerts | "No alerts — you're all clear" |
   | Charts | "Not enough data to show chart" |

3. **Symptom severity display** — RESOLVED
   - Backend uses 0-3 scale with explicit labels (validation.ts line 15):
     - 0 = none
     - 1 = mild
     - 2 = moderate
     - 3 = severe
   - PDF design shows 1-10 slider — but backend is authoritative

   **Decision:** Use 4-option selector (not slider) with clinical labels.

   | Value | Label | UI Representation |
   |-------|-------|-------------------|
   | 0 | None | Unselected / empty state |
   | 1 | Mild | Lightest indicator |
   | 2 | Moderate | Medium indicator |
   | 3 | Severe | Strong/red indicator |

   **Flutter implementation:**
   ```dart
   enum SymptomSeverity {
     none(0, 'None'),
     mild(1, 'Mild'),
     moderate(2, 'Moderate'),
     severe(3, 'Severe');

     final int value;
     final String label;
     const SymptomSeverity(this.value, this.label);
   }
   ```

   **React implementation:**
   ```typescript
   const SEVERITY_OPTIONS = [
     { value: 0, label: 'None' },
     { value: 1, label: 'Mild' },
     { value: 2, label: 'Moderate' },
     { value: 3, label: 'Severe' },
   ] as const;
   ```

4. **Unit display preferences** — RESOLVED
   - Backend defaults to lbs for weight display (units.ts line 18-24):
     ```typescript
     export const DISPLAY_UNITS = {
       WEIGHT: "lbs",  // US default
       BP_SYSTOLIC: "mmHg",
       BP_DIASTOLIC: "mmHg",
       SPO2: "%",
       HEART_RATE: "bpm",
     };
     ```
   - The `displayUnit` parameter is internal to services, NOT exposed via API query params
   - No patient preferences update endpoint exists

   **Decision:** Accept backend defaults for MVP.

   | Measurement | Display Unit | Notes |
   |-------------|--------------|-------|
   | Weight | lbs | US default hardcoded in backend |
   | Blood Pressure | mmHg | Universal standard |
   | SpO2 | % | Universal |
   | Heart Rate | bpm | Universal |

   **MVP behavior:**
   - All frontends display weight in lbs (matching backend's `displayUnit: "lbs"`)
   - Patients submit weight in lbs (backend converts to kg internally)
   - No unit toggle UI needed for MVP

   **Post-MVP enhancement (if needed):**
   - Add `PATCH /patient/me` endpoint to update preferences
   - Store `{preferredWeightUnit: "kg" | "lbs"}` in patient preferences
   - Pass `displayUnit` query param to chart/summary endpoints
   - Toggle UI in settings screen

### KNOWN LIMITATIONS (Accept for MVP)

_(All "MUST RESOLVE" items have been resolved — items 1-4 above)_

5. **No patient-scoped alerts endpoint for clinician**
   - Use client-side filtering
   - Acceptable if alert count stays reasonable (<100 per clinician)

6. **No alertCount/lastCheckinAt in patient list**
   - Show simple list for MVP
   - Enhancement opportunity post-MVP

7. **No logout endpoint**
   - Rely on token expiration + local storage clearing

---

## Summary

| Category | Count |
|----------|-------|
| Patient Screens | 10 |
| Clinician Screens | 10 |
| Backend Endpoints Used | 28 |
| Confirmed Working | 28 |
| True Blocking Gaps | 0 |
| Workaround Gaps | 3 |
| Slices Defined | 10 |
| Risks Resolved | 4/4 ✓ |

### All Risks Resolved

| # | Risk | Resolution |
|---|------|------------|
| 1 | Session handling (JWT storage) | Flutter: `flutter_secure_storage`; React: in-memory only |
| 2 | Enrollment prerequisite | Patient routes don't check enrollment; use standard empty states |
| 3 | Symptom severity (0-3 vs 1-10) | Use 4-option selector with clinical labels (None/Mild/Moderate/Severe) |
| 4 | Unit display preferences | Accept backend defaults (lbs for weight, universal units for others) |

### Ready for Implementation

**First Executable Slice:**
```
Slice 1: Patient login → add weight → see it in history
Endpoints: POST /auth/patient/login, POST /patient/measurements, GET /patient/measurements, GET /patient/charts/WEIGHT
```

All endpoints verified against actual backend implementation. All ambiguities resolved. Frontend development can begin.
