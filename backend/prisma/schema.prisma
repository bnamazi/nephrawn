generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// Slice 1: Foundation Entities
// ============================================

model Patient {
  id           String   @id @default(uuid())
  email        String   @unique
  passwordHash String
  name         String
  dateOfBirth  DateTime @db.Date
  preferences  Json     @default("{}")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  enrollments      Enrollment[]
  interactionLogs  InteractionLog[]
  symptomCheckins  SymptomCheckin[]

  @@map("patients")
}

model Clinician {
  id           String        @id @default(uuid())
  email        String        @unique
  passwordHash String
  name         String
  role         ClinicianRole @default(CLINICIAN)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  enrollments     Enrollment[]
  interactionLogs InteractionLog[]

  @@map("clinicians")
}

enum ClinicianRole {
  CLINICIAN
  ADMIN
}

model Enrollment {
  id           String           @id @default(uuid())
  patientId    String
  clinicianId  String
  status       EnrollmentStatus @default(ACTIVE)
  isPrimary    Boolean          @default(true)
  enrolledAt   DateTime         @default(now())
  dischargedAt DateTime?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  patient   Patient   @relation(fields: [patientId], references: [id])
  clinician Clinician @relation(fields: [clinicianId], references: [id])

  @@unique([patientId, clinicianId])
  @@index([clinicianId, status])
  @@map("enrollments")
}

enum EnrollmentStatus {
  ACTIVE
  PAUSED
  DISCHARGED
}

model InteractionLog {
  id              String          @id @default(uuid())
  patientId       String
  clinicianId     String?
  timestamp       DateTime        @default(now())
  interactionType InteractionType
  durationSeconds Int?
  metadata        Json            @default("{}")
  createdAt       DateTime        @default(now())

  patient   Patient    @relation(fields: [patientId], references: [id])
  clinician Clinician? @relation(fields: [clinicianId], references: [id])

  @@index([patientId, timestamp])
  @@index([clinicianId, timestamp])
  @@map("interaction_logs")
}

enum InteractionType {
  PATIENT_CHECKIN
  PATIENT_MEASUREMENT
  CLINICIAN_VIEW
  CLINICIAN_ALERT_ACK
  CLINICIAN_NOTE
  CLINICIAN_CALL
  CLINICIAN_MESSAGE
}

// ============================================
// Slice 2: Symptom Check-ins
// ============================================

model SymptomCheckin {
  id        String   @id @default(uuid())
  patientId String
  timestamp DateTime @default(now())
  symptoms  Json
  notes     String?
  createdAt DateTime @default(now())

  patient Patient @relation(fields: [patientId], references: [id])

  @@index([patientId, timestamp])
  @@map("symptom_checkins")
}
